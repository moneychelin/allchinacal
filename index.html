<script>
    // 숫자 천 단위 포맷 함수
    function formatNumber(num) {
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    // 첫 번째 계산기: 구대 소싱 계산
    function calculateSourcing() {
        const competitorPrice = parseFloat(document.getElementById('competitor_price').value);
        const localPrice = parseFloat(document.getElementById('local_price').value);

        if (isNaN(competitorPrice) || isNaN(localPrice)) {
            alert('숫자를 올바르게 입력해주세요.');
            return;
        }

        // 예상 판매가 및 이익 계산
        let expectedPrice = localPrice * 192 + localPrice * 192 * 0.05; // 기본 계산식
        expectedPrice = Math.ceil(expectedPrice / 500) * 500; // 반올림 처리
        const profit = Math.floor(competitorPrice - expectedPrice);

        // 결과 표시
        document.getElementById('expected_price').textContent = formatNumber(expectedPrice) + " 원";
        document.getElementById('profit').textContent = formatNumber(profit) + " 원";
    }

    // 두 번째 계산기: 중구대 마진 계산
    function calculateProfit() {
        const exchangeRate = parseFloat(document.getElementById('exchange_rate').value);
        const sellingPrice = parseFloat(document.getElementById('selling_price').value.replace(/,/g, ""));
        const taobaoPrice = parseFloat(document.getElementById('taobao_price').value.replace(/,/g, ""));
        const selectedWeight = parseFloat(document.getElementById('weight').value);

        if (isNaN(exchangeRate) || isNaN(sellingPrice) || isNaN(taobaoPrice) || isNaN(selectedWeight)) {
            alert('모든 필드를 올바르게 입력해주세요.');
            return;
        }

        // 배송비 계산 로직
        const shippingCosts = {};
        for (let i = 1; i <= 60; i++) {
            const weight = i * 0.5;
            shippingCosts[weight] = 4700 + (i - 1) * 350; // 배송비 계산
        }

        const shippingCost = shippingCosts[selectedWeight] || 0; // 무게에 따른 배송비 가져오기
        const profit = sellingPrice - (sellingPrice * 0.05) - (taobaoPrice * exchangeRate * 1.077) - shippingCost;

        // 결과 표시
        const resultElement = document.getElementById('profit_second');
        resultElement.textContent = formatNumber(profit) + " 원";
        resultElement.style.color = profit >= 0 ? "red" : "blue"; // 순익에 따라 색상 변경
    }

    // 필드 초기화 (구대 소싱)
    function resetSourcingFields() {
        document.getElementById('competitor_price').value = "";
        document.getElementById('local_price').value = "";
        document.getElementById('expected_price').textContent = "-";
        document.getElementById('profit').textContent = "-";
        document.getElementById('competitor_price').focus(); // 커서 이동
    }

    // 필드 초기화 (중구대 마진)
    function resetProfitFields() {
        document.getElementById('selling_price').value = "";
        document.getElementById('taobao_price').value = "";
        document.getElementById('weight').value = "";
        document.getElementById('profit_second').textContent = "-";
        document.getElementById('selling_price').focus(); // 커서 이동
    }

    // ESC 키 처리
    document.addEventListener("keydown", function (event) {
        if (event.key === "Escape") {
            if (document.activeElement.closest('#calculator1')) {
                resetSourcingFields();
            } else if (document.activeElement.closest('#calculator2')) {
                resetProfitFields();
            }
        }
    });
</script>
